\begin{document}
\begin{tikzpicture}

\tikzset{
  x=1.3cm,
  y=1.3cm,
  value/.style={
    font=\Large,
  },
}

\tikzset{
  every list/.style={
    element size=1.3cm,
    font=\Large,
    line width=.8mm,
  },
  sublist/.style={
    line width=.6mm,
    element size=1cm,
    font=\large,
  },
}

\tikzset{
  fun/.style={
    shape=function,
    function port width=2.5mm,
    function port funnel width=1.25mm,
    function port separation=1.25mm,
    function port height=1.25mm,
    line width=.4mm,
    draw,
    node contents={#1},
  },
  fun/.default={\texttt{fun}},
}

\tikzset{
  ->/.style={
    -Stealth,
    line width=0.4mm,
  },
  <-/.style={
    Stealth-,
    line width=0.4mm,
  },
}

\tikzset{
  measure amplitude=5mm,
  measure overflow=1mm,
}

\tikzset{
  every brace/.style={
    line width=.4mm,
  },
  brace amplitude=2mm,
  brace raise=1mm,
}

\newcommand\bracetobrace[4]{
  \draw [brace] (#1) -- (#2);
  \coordinate (first brace) at (last brace);
  \draw [brace] (#3) -- (#4);
  \draw [->] (first brace) -- (last brace);
}

\makeatletter
\newcommand\currcoord{\the\tikz@lastxsaved,\the\tikz@lastysaved}
\makeatother

\newcommand\applyfuntop[4][2]{
  \node (last label) [above=#1 of #2] {#4};
  \node (last function) at ($ (last label.base)!.5!(#2) $) [function in=south, function out=north, fun=#3];
  \draw [->] (#2) -- (last function.in);
  \draw [->, shorten >=1mm] (last function.out) -- (last label.base);
}

\newcommand\applyfunbottom[4][2]{
  \node (last label) [below=#1 of #2] {#4};
  \node (last function) at ($ (last label)!.5!(#2) $) [fun=#3];
  \draw [->] (#2) -- (last function.in);
  \draw [->] (last function.out) -- (last label);
}

\def\true{\texttt{true}}
\def\false{\texttt{false}}
\def\nil{\texttt{nil}}

