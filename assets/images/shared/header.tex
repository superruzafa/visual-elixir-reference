\begin{document}
\begin{tikzpicture}

\tikzset{
  x=2cm,
  y=2cm,
  font=\LARGE,
  value/.style={
    %font=\Large,
  },
}

\tikzset{
  keyword list/.style={
    /funprog/.cd,
    map=#1,
    data struct alias=keyword list #1,
  }
}

\tikzset{
  every empty collection/.style={
    element size=2cm,
    line width=.4mm,
  },
}

\tikzset{
  every list/.style={
    element size=2cm,
    wrapper padding=4mm,
    line width=1mm,
  },
}

\tikzset{
  tuple delimiter=braces,
  every tuple/.style={
    element size=0pt,
    wrapper padding=4mm,
    %font=\Large,
    nodes={
      text height=1em,
      text depth=.75em
    }
  },
}

\tikzset{
  fun/.style={
    shape=function,
    function port width=5mm,
    function port funnel width=2.5mm,
    function port separation=1.25mm,
    function port height=1.875mm,
    line width=.8mm,
    font=\Large,
    draw,
    node contents={#1},
  },
  fun/.default={\texttt{fun}},
}

\tikzset{
  ->/.style={
    -{Stealth[#1]},
    line width=0.8mm,
  },
  <-/.style={
    {Stealth[#1]}-,
    line width=0.8mm,
  },
}

\tikzset{
  exception/.style={
    decorate,
    decoration={zigzag, segment length=2mm, amplitude=.25mm},
    line width=.4mm,
  }
}

\tikzset{
  enter iteration start angle=30,
  enter iteration delta angle=60,
  exit iteration start angle=150,
  exit iteration delta angle=60,
  every enter iteration/.style={<-, radius=.85cm},
  every iteration/.style={->},
  every exit iteration/.style={->, radius=.85cm},
}

\tikzset{
  every measure arrow/.style={
    ->,
    line width=.4mm,
  },
  measure amplitude=1cm,
  measure overflow=2.5mm,
  measure below/.style={
    measure amplitude=-1cm,
  }
}

\tikzset{
  every brace/.style={
    line width=.6mm,
  },
  brace amplitude=5mm,
  brace raise=2.5mm,
}

\newcommand\bracetobrace[4]{
  \draw [brace] (#1) -- (#2);
  \coordinate (first brace) at (last brace);
  \draw [brace] (#3) -- (#4);
  \draw [->, out=270, in=90] (first brace) to (last brace);
}

\makeatletter
\newcommand\currcoord{\the\tikz@lastxsaved,\the\tikz@lastysaved}
\makeatother

\newcommand\applyfuntop[4][2]{
  \node (last label) [above=#1 of #2] {#4};
  \node (last function) at ($ (last label.base)!.5!(#2) $) [function in=south, function out=north, fun=#3];
  \draw [->] (#2) -- (last function.in);
  \draw [->, shorten >=1mm] (last function.out) -- (last label.base);
}

\newcommand\applyfunbottom[4][2]{
  \node (last label) [below=#1 of #2, anchor=base] {#4};
  \node (last function) at ($ ($ (last label.base) + (0, 1ex) $)!.5!(#2) $) [fun=#3];
  \draw [->] (#2) -- (last function.in);
  \draw [->] (last function.out) -- (last label);
}

\def\true{\texttt{true}}
\def\false{\texttt{false}}
\def\nil{\texttt{nil}}
\def\ok{\texttt{:ok}}
\def\error{\texttt{:error}}

\def\key{\texttt{key}}
\newcommand\vof[1]{v_\texttt{\small{#1}}}
\newcommand{\vkey}{\vof{key}}
