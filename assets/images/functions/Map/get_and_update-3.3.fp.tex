\matrix [map=a] {
  \node [index=1]; &
  \node [elements between]; &
  \node [index=i-1]; &
  \node (akey) [key value={\texttt{key}}{$\vkey$}];
    \coordinate (vkey) at (last value.west); &
  \node [index=i+1]; &
  \node [elements between]; &
  \node [index=n]; \\
};

\matrix [tuple=t, below=3 of map a]{
  \node (tkey) {$\vkey$}; & \node [separator]; &
  \node (t2) [element size=1.7cm, placeholder=4]; \\
};

\matrix at (t2) [map=b] {
  \node [index=1]; &
  \node [elements between]; &
  \node [index=i-1]; &
  \node [index=i+1]; &
  \node [elements between]; &
  \node [index=n]; \\
};

\node (fun) at ($ ($ (map a)!.33!(map b) $) + (-.45, 0) $) [fun];

\draw [->] (vkey) -| (fun.in);
\draw [->] (fun.out) -- +(0, -.5)
  node [below] {\texttt{:pop}};


%\begin{scope}
  %[start chain=tuple going base right, every node/.style={on chain=tuple, inner sep=0}, node distance=0]
  %\node [below left=.75 and 0 of fun] {$\{$};
  %\node (res b) {$b$};
  %\node {,\,};
  %\node (res vfun) {$\vof{fun}$};
  %\node {$\}$};
%\end{scope}

%\node (res) [fit=(res b) (res vfun)] {};
%\draw [->] (vkey) -| (fun.north);
%\draw [->] (fun.out) -- (res.north);

%\draw [->, shorten <=.5ex] (res b) -- +(0, -.5) -| (b.north);
%\draw [->, shorten <=.5ex] (res vfun) |- (vfun);

