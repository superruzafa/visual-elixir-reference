\matrix [map=b] {
  \node [key value={$b_1$}{$c_1$}]; &
  \node [key value={$b_2$}{$c_2$}]; &
  \node [elements between]; &
  \node [key value={$b_n$}{$c_n$}]; \\
};

\node (legend) [right=.5 of map b]
  {$c_j=\displaystyle\sum_{i=1}^{m}1|b_i=b_j$};

\coordinate (x) at ($ (map b.west)!.5!(legend.east) $);

\matrix [list=a, above=2 of x |- map b.north] {
  \node [index=1]; &
  \node [index=2]; &
  \node [index=3]; &
  \node [elements between]; &
  \node [index=m-1]; &
  \node [index=m]; \\
};

\foreach \i/\j in {
  1/2,
  2/m,
  3/1,
  m-1/m,
  m/2
}{
  \applyfuntop{a\i.north}{\texttt{fun}}{$b_{\j}$}
}

\coordinate (x) at ($ (map b.north)!.5!(map b.north |- list a.south) $);

\node at (x) [draw, rotate=-90, single arrow, single arrow head extend=1mm] {};

